# BTCR v0.1 Decisions

Authors: Kim Hamilton Duffy, Dan Pape, Ryan Grant, Christopher Allen, Anthony Ronning, Ganesh Annan, Wolf McNally

## Abstract
The Bitcoin Reference (BTCR) DID method supports DIDs using the Bitcoin blockchain. This method has been under development through Rebooting Web of Trust events and hackathons over the past year. The BTCR method's reliance on the Bitcoin blockchain presents both advantages and design challenges. During RWOT7, the authors made a number of design decisions -- largely scope-cutting in nature -- in order to lock down an MVP version, which we'll refer to as v0.1. This paper documents those decisions, which will apply to the upcoming v0.1 BTCR method specification and associated v0.1 BTCR reference implementation.

## Overview

The design decisions include:
- What's in and out of scope
- BTCR semantics
- Wallet functionality
- Credential schema and content

## Scope clarifications

The most critical aspects to locking down a v0.1 of the BTCR method is defining what's out of scope. These are aspects where that either introduced a large amount of complexity or presented implementation difficulties given currently available libraries. These will assuredly be addressed in later versions of the BTCR method. 

### 1. Assume P2PKH scripts
Our initial BTCR implementations relied on Pay to Public Key Hash (P2PKH) scripts. We explored other script types, but these introduced complications extracting the signing public key directly from the transaction, which we require for the final DID document.

For this reason, we decided that only P2PKH scripts are supported, and other scripts types -- for example P2SH and Segwit -- are out of scope.

Because of the size and cost implications, we will revisit this decision in later versions.

### 2. Only a URL in OP_RETURN
A BTCR transaction allows an optional OP_RETURN field pointing to a "continuation" DID document, which is a DID document containing additional key material and capabilities to be merged into the final BTCR DID Document (generated by the resolver).

The storage type of the continuation document introduced a fork: if the link in the transaction pointed to mutable storage, the document could be updated after the transaction with the known DID (which isn't known until after the tx has been confirmed). However, if the link was a cryptographic hash link, then document could not be changed without invalidating the hash.

For the latter case, we addressed this by considering the transaction signature an implicit signature on the immutable content. This introduces a requirement for the resolvers to be aware of different link types (which are content hashes or not), which we've tracked [here](https://github.com/w3c-ccg/didm-btcr/issues/2).

We will punt on this issue for a practical reason. Realistically, IPFS is the only immutable storage we would want to use. However, this introduces mobile wallet implementation difficulties, as IPFS lib in iPhone is a non-starter:
- it has to be running all the time (TODO -- details?)
- requires persistence

This allows us to cut scope and address the case of mutable storage only.

### 3. Extended DDO in github

Extending on the previous decision, we've decided that our reference extended DID Documents will be stored in github, and updated after tx confirmation with the DID and signature. This is largely for convenience.

### 4. Testnet only

Most importantly, we've decided to only support testnet (not mainnet) as we work through the initial reference implementations and obtain feedback from test usage.

## Semantics

A BTCR DID document relies partially on transaction structure, partially on the continuation DID document. We clarified the semantics of scenarios that were previously undefined. 

### 1. Transaction keys

#### a. TXIn key

>  Question: I had TXIn key only verifies DDOs, which is ambiguous. Given that we still seem to give it default auth capabilities, I'm assuming we mean the following

The transaction input (signing) key is the only key that can be used to verify continuation DID documents. 

It also is given a default auth capability by the resolver. 

> But question: given that we're focusing only on mutable storage, perhaps we're not giving any default auth capability? I.e. we just write this explicity in the DID doc, and merge in the DID (identifier) after the tx is confirmed?


#### b. TXOut key

If the OP_RETURN exists and points to a continuation DDO, the TXOut key has no implication. In other words, it is not given any default capabilities; we just accept the continuation DID document.

If the OP_RETURN doesn't exist, we give the TXOut key the ability to verify verifiable credentials.

> TODO: example?

### 2. No OP_RETURN after a TX means revoked

A BTCR DID is considered revoked if:
- There is more than 1 transaction in the BTCR DID "chain"
- The latest transaction has no OP_RETURN

The first factor is important because a missing OP_RETURN is considered valid in the very first tx in the chain. However, all subsequent txs in the chain must have OP_RETURNs or else it is considered revoked.

This behavior is enforced by BTCR resolvers.


## Wallet functionality

### 1. ID Keys distinct from DIDs in wallet

> I forgot why we called this out...

### 2. Transactions

> I forgot what we are getting at here

Base tx doesn't need to broadcast/fund TX to set initial funds (tx_0). Only needs to create TXs for tx_n (n>0) 

### 3. Tip following

> TODO: this section needs work

- Ideally follow best practice BIP 157/158. Problem is that libraries not necessarily available. 
- Fallback is Kulpreet's REST service.

About BIP 157/158
- Neutrino
- Lightning branch of Go code
- Not as efficient as SPV: SPV requests lists of addresses it cares about. Neutro slower because it attempts to hide addresses it cares about.


## Credential schema and content

> TODO: this section needs work

### 1. Use JSON-LD 1.1 javascript lib, because 0.1 doesn't need hardcore verifiers
### 2. Restrict to schema.org schemas. Can use Christopher's test cases
### 3. Privacy: stick to pseudoanonymous claim content
### 4. Restrict to VCs one wishes to share
